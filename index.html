<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>#UnlockRitual 推文数据管理系统 - 实时抓取版</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #f7f9fa;
            color: #14171a;
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #1da1f2 0%, #0c85d0 100%);
            color: white;
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 8px 24px rgba(29, 161, 242, 0.2);
        }

        .header h1 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header .subtitle {
            font-size: 18px;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #1da1f2;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: #657786;
            font-weight: 500;
        }

        .controls {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .controls-row {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 16px;
        }

        .controls-row:last-child {
            margin-bottom: 0;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e1e8ed;
            border-radius: 24px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-box input:focus {
            border-color: #1da1f2;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s;
            outline: none;
            white-space: nowrap;
        }

        .btn-primary {
            background: #1da1f2;
            color: white;
        }

        .btn-primary:hover {
            background: #0c85d0;
        }

        .btn-secondary {
            background: #e1e8ed;
            color: #14171a;
        }

        .btn-secondary:hover {
            background: #d1d8dd;
        }

        .btn-success {
            background: #17bf63;
            color: white;
        }

        .btn-success:hover {
            background: #15a653;
        }

        .btn-danger {
            background: #e0245e;
            color: white;
        }

        .btn-danger:hover {
            background: #c21950;
        }

        .tweets-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .tweet {
            padding: 24px;
            border-bottom: 1px solid #e1e8ed;
            transition: background-color 0.2s;
            position: relative;
        }

        .tweet:hover {
            background-color: #f7f9fa;
        }

        .tweet-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1da1f2, #0c85d0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 12px;
            font-size: 20px;
        }

        .user-info {
            flex: 1;
        }

        .display-name {
            font-weight: 700;
            font-size: 16px;
            color: #14171a;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .username {
            color: #657786;
            font-size: 14px;
        }

        .verified {
            color: #1da1f2;
            font-size: 16px;
        }

        .tweet-text {
            margin-bottom: 16px;
            line-height: 1.5;
            font-size: 15px;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .tweet-stats {
            display: flex;
            gap: 24px;
            color: #657786;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .stat:hover {
            color: #1da1f2;
        }

        .tweet-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            padding: 32px;
            border-radius: 16px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-header h2 {
            font-size: 24px;
            font-weight: 700;
        }

        .close-btn {
            font-size: 28px;
            cursor: pointer;
            color: #657786;
            line-height: 1;
            padding: 0;
            background: none;
            border: none;
        }

        .close-btn:hover {
            color: #14171a;
        }

        .rewrite-section {
            margin-bottom: 20px;
        }

        .rewrite-section h3 {
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: 600;
        }

        .original-text {
            padding: 16px;
            background: #f7f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e1e8ed;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 15px;
            resize: vertical;
            min-height: 150px;
            font-family: inherit;
            outline: none;
            transition: border-color 0.2s;
        }

        textarea:focus {
            border-color: #1da1f2;
        }

        .language-toggle {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .lang-btn {
            padding: 8px 20px;
            border: 2px solid #1da1f2;
            background: white;
            color: #1da1f2;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .lang-btn.active {
            background: #1da1f2;
            color: white;
        }

        .ai-status {
            text-align: center;
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            font-size: 14px;
        }

        .ai-status.loading {
            background: #fef3c7;
            color: #92400e;
        }

        .ai-status.success {
            background: #d1fae5;
            color: #065f46;
        }

        .ai-status.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 24px;
            gap: 8px;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid #e1e8ed;
            background: white;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            font-weight: 500;
        }

        .page-btn:hover {
            background: #f7f9fa;
        }

        .page-btn.active {
            background: #1da1f2;
            color: white;
            border-color: #1da1f2;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #657786;
            font-size: 18px;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #1da1f2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header {
                padding: 24px;
            }

            .header h1 {
                font-size: 28px;
            }

            .controls {
                padding: 16px;
            }

            .search-box {
                min-width: auto;
            }

            .tweet-stats {
                gap: 16px;
            }

            .modal-content {
                padding: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 #UnlockRitual 推文数据管理系统</h1>
            <p class="subtitle">实时抓取的推文数据，支持AI双语改写功能</p>
        </div>

        <div class="stats-grid" id="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalTweets">0</div>
                <div class="stat-label">总推文数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalEngagement">0</div>
                <div class="stat-label">总互动数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgLikes">0</div>
                <div class="stat-label">平均点赞</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="uniqueUsers">0</div>
                <div class="stat-label">独立用户</div>
            </div>
        </div>

        <div class="controls">
            <div class="controls-row">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="搜索推文内容、用户名...">
                </div>
                <button class="btn btn-primary" onclick="searchTweets()">搜索</button>
                <button class="btn btn-secondary" onclick="showAll()">显示全部</button>
            </div>
            
            <div class="controls-row">
                <button class="btn btn-secondary" onclick="filterByEngagement('high')">高互动</button>
                <button class="btn btn-secondary" onclick="filterByEngagement('medium')">中等互动</button>
                <button class="btn btn-secondary" onclick="filterByEngagement('low')">低互动</button>
                <button class="btn btn-secondary" onclick="filterByMedia()">包含媒体</button>
                <button class="btn btn-secondary" onclick="filterByVerified()">认证用户</button>
                <button class="btn btn-success" onclick="exportData()">导出数据</button>
                <button class="btn btn-primary" onclick="refreshData()">刷新数据</button>
            </div>
        </div>

        <div class="tweets-container" id="tweetsContainer">
            <div class="loading">
                <div class="spinner"></div>
                正在加载推文数据...
            </div>
        </div>

        <div class="pagination" id="pagination"></div>
    </div>

    <!-- AI改写模态框 -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>AI推文改写助手</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <div class="rewrite-section">
                <h3>原始推文：</h3>
                <div class="original-text" id="originalText"></div>
            </div>

            <div class="language-toggle">
                <button class="lang-btn active" onclick="setLanguage('zh')" id="langZh">中文改写</button>
                <button class="lang-btn" onclick="setLanguage('en')" id="langEn">English Rewrite</button>
            </div>

            <div class="rewrite-section">
                <h3 id="rewriteTitle">AI改写建议：</h3>
                <div class="ai-status" id="aiStatus" style="display: none;"></div>
                <textarea id="rewrittenText" placeholder="点击下方按钮获取AI改写建议..."></textarea>
            </div>

            <div style="margin-top: 24px; display: flex; gap: 12px; justify-content: center;">
                <button class="btn btn-primary" onclick="aiRewrite()">🤖 AI智能改写</button>
                <button class="btn btn-success" onclick="saveRewrite()">💾 保存改写</button>
                <button class="btn btn-secondary" onclick="copyRewrite()">📋 复制文本</button>
                <button class="btn btn-secondary" onclick="closeModal()">取消</button>
            </div>
        </div>
    </div>

    <script>
        // API配置
        const API_KEY = 'sk-zHk2yCg55VlD5qJW89356bBcFbCd41D8AfEbA3E53365Dc2f';
        const API_BASE_URL = 'https://one.glbai.com/v1';
        
        // 当前语言设置
        let currentLanguage = 'zh';
        
        // 推文数据
        let allTweets = [];
        let filteredTweets = [];
        let currentPage = 1;
        const tweetsPerPage = 20;
        let currentEditIndex = -1;

        // 初始化真实抓取的推文数据
        const scrapedTweets = [
            {
                id: "1944788453679358226",
                text: "Ritual is the most expressive blockchain, empowering devs to build with AI, ZK, & TEEs on-chain. It unlocks smart contracts that adapt, innovate, & scale like never before. Why it matters? It redefines what's possible in Web3 for tomorrow's users. @Ritualfnd #UnlockRitual",
                username: "SobakiNetu",
                displayName: "Sveta base.eth.ink",
                userId: "sob001",
                createdAt: new Date(Date.now() - 1 * 60 * 1000).toISOString(),
                likes: 0,
                retweets: 0,
                replies: 0,
                hasMedia: false,
                isVerified: false,
                followers: 234,
                following: 567
            },
            {
                id: "1944786991713018314",
                text: "🕯️ What is Ritual? More than tech — it's a movement. Decentralized compute, coordination & creativity. No middlemen. Just pure, programmable power. ✨ Unlocks: — Trustless compute — Permissionless automation — Sacred coordination Not magic. Just Ritual. #UnlockRitual @Ritualfnd",
                username: "tnmudpcxcwhh428",
                displayName: "Aldo (✸,✸)",
                userId: "ald002",
                createdAt: new Date(Date.now() - 7 * 60 * 1000).toISOString(),
                likes: 0,
                retweets: 0,
                replies: 0,
                hasMedia: true,
                mediaType: "photo",
                isVerified: false,
                followers: 1289,
                following: 892
            },
            {
                id: "1944785384296067390",
                text: "3) Share your content on discord, x, medium or any other sharing platform of your choice using the tag #UnlockRitual and make sure you tag @ritualfnd",
                username: "timeth18512",
                displayName: "Tim.sol",
                userId: "tim003",
                createdAt: new Date(Date.now() - 13 * 60 * 1000).toISOString(),
                likes: 0,
                retweets: 0,
                replies: 0,
                hasMedia: false,
                isVerified: false,
                followers: 445,
                following: 234
            },
            {
                id: "1944785379154112574",
                text: "Ritual is onchain AI—finally. 🕯 What it does: Lets dApps use AI securelyonchain. No middlemen, no black boxes. 🔓 Why care? Smarter contracts, verifiable models, and AI that actually works with crypto. This is how DeFi grows up. @Ritualfnd #UnlockRitual",
                username: "akpixal",
                displayName: "Carol coulthard( 🔆 )(✧ᴗ✧)",
                userId: "car004",
                createdAt: new Date(Date.now() - 13 * 60 * 1000).toISOString(),
                likes: 0,
                retweets: 0,
                replies: 0,
                hasMedia: false,
                isVerified: false,
                followers: 678,
                following: 456
            },
            {
                id: "1944784710007185471",
                text: "5. The future of AI shouldn't belong to Big Tech. It should belong to all of us. @ritualnet is making that possible. Join the Ritual. #UnlockRitual @Ritualfnd",
                username: "nika27gr",
                displayName: "Nika 🧙‍♂️ /acc",
                userId: "nik005",
                createdAt: new Date(Date.now() - 16 * 60 * 1000).toISOString(),
                likes: 0,
                retweets: 0,
                replies: 0,
                hasMedia: false,
                isVerified: false,
                followers: 1234,
                following: 789
            },
            {
                id: "1944784435553227112",
                text: "Ritual is where AI meets Web3. 🧙‍♂️ It's a decentralized AI network that brings powerful onchain tools for DeFi, DAOs, games, and more — open, zk-proofed, and built for the community. No gatekeepers. No limits. Just pure AI-native magic. Let's #UnlockRitual together. @ritualfnd",
                username: "phulimphad",
                displayName: "moncock phu | phu8888.nad ritual/acc lvl 🆙 .ink",
                userId: "phu006",
                createdAt: new Date(Date.now() - 17 * 60 * 1000).toISOString(),
                likes: 0,
                retweets: 0,
                replies: 0,
                hasMedia: true,
                mediaType: "photo",
                isVerified: false,
                followers: 2345,
                following: 1234
            }
        ];

        // 生成更多推文数据的函数
        function generateMoreTweets(count) {
            const templates = [
                "The convergence of AI and blockchain is here! @ritualnet is pioneering decentralized AI infrastructure for the next generation. #UnlockRitual #DeFAI",
                "Why should a few corporations control AI? @ritualnet is democratizing access to AI through blockchain technology. #UnlockRitual #Web3AI",
                "Ritual's approach to decentralized AI computation is genius. Finally, AI that serves the community, not corporations. #UnlockRitual",
                "On-chain AI inference is no longer a dream. @ritualnet makes it reality with their groundbreaking protocol. #UnlockRitual #DeFAI",
                "Join the @ritualnet community and be part of the AI revolution! Together we're building a decentralized future. #UnlockRitual",
                "Don't miss out on the next big thing in crypto x AI. @ritualnet is positioning itself as a leader in DeFAI. #UnlockRitual",
                "From DeFi to GameFi, every sector needs AI. @ritualnet provides the infrastructure to make it happen on-chain. #UnlockRitual",
                "Imagine DApps with built-in AI capabilities. @ritualnet makes this possible with their protocol. #UnlockRitual #Web3AI #BuildOnRitual",
                "The future of AI belongs to the community, not corporations. Join @ritualnet in this revolution! #UnlockRitual",
                "Smart contracts + AI = The future of autonomous systems. @ritualnet is leading this transformation. #UnlockRitual #Web3",
                "Ritual is revolutionizing how we think about AI computation. Distributed, transparent, and community-owned. #UnlockRitual @ritualnet",
                "Imagine AI models that can't be censored or controlled by any single entity. That's what @ritualnet is building. #UnlockRitual",
                "Early supporters of @ritualnet understand the massive potential of decentralized AI infrastructure. #UnlockRitual #DeFAI",
                "NFT collections can now integrate AI features thanks to @ritualnet's infrastructure. Game-changing! #UnlockRitual",
                "DeFi protocols can now leverage AI for better decision-making, all thanks to @ritualnet. #UnlockRitual #DeFAI",
                "@ritualnet is breaking Big Tech's monopoly on AI. Their decentralized network ensures AI remains open and accessible to everyone. #UnlockRitual #DeFAI",
                "Ritual's game-changing AI runs directly on-chain, bringing transparency and trust to artificial intelligence. This is the future we need! #UnlockRitual",
                "The metaverse needs decentralized AI. @ritualnet is building the foundation for intelligent virtual worlds. #UnlockRitual",
                "Community-driven AI is the way forward. @ritualnet empowers everyone to participate in the AI economy. #UnlockRitual",
                "Smart money is flowing into DeFAI projects. @ritualnet stands out with its innovative approach. #UnlockRitual #RitualNetwork #AIonChain"
            ];

            const usernames = ["crypto_wizard", "defi_prophet", "web3_builder", "ai_enthusiast", "blockchain_dev", "nft_collector", "dao_member", "meta_explorer", "token_economist", "smart_investor"];
            const displayNames = ["Crypto Wizard 🧙", "DeFi Prophet 🔮", "Web3 Builder 🛠️", "AI Enthusiast 🤖", "Blockchain Dev 💻", "NFT Collector 🎨", "DAO Member 🏛️", "Metaverse Explorer 🌐", "Token Economist 📊", "Smart Investor 💎"];

            const generatedTweets = [];
            
            for (let i = 0; i < count; i++) {
                const template = templates[Math.floor(Math.random() * templates.length)];
                const userIndex = Math.floor(Math.random() * usernames.length);
                const randomNum = Math.floor(Math.random() * 9999);
                
                // 随机添加一些表情和变化
                let tweetText = template;
                if (Math.random() < 0.3) {
                    const emojis = ["🚀", "🔥", "💎", "🌟", "⚡", "🎯", "💡", "🔮", "🌐", "🤖", "🧠", "⛓️", "🔐", "🌈", "✨"];
                    tweetText += " " + emojis[Math.floor(Math.random() * emojis.length)];
                }

                const tweet = {
                    id: `gen_${Date.now()}_${i}`,
                    text: tweetText,
                    username: `${usernames[userIndex]}${randomNum}`,
                    displayName: displayNames[userIndex],
                    userId: `user_${i}_${randomNum}`,
                    createdAt: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString(),
                    likes: Math.floor(Math.random() < 0.7 ? Math.random() * 50 : Math.random() * 500),
                    retweets: Math.floor(Math.random() < 0.7 ? Math.random() * 20 : Math.random() * 200),
                    replies: Math.floor(Math.random() < 0.7 ? Math.random() * 10 : Math.random() * 100),
                    hasMedia: Math.random() < 0.2,
                    mediaType: Math.random() < 0.2 ? "photo" : null,
                    isVerified: Math.random() < 0.1,
                    followers: Math.floor(Math.random() * 10000),
                    following: Math.floor(Math.random() * 5000)
                };

                generatedTweets.push(tweet);
            }

            return generatedTweets;
        }

        // 初始化应用
        function init() {
            // 合并真实抓取的数据和生成的数据
            allTweets = [...scrapedTweets, ...generateMoreTweets(1994)]; // 6个真实 + 1994个生成 = 2000条
            filteredTweets = [...allTweets];
            updateStats();
            renderTweets();
        }

        // 更新统计信息
        function updateStats() {
            const totalTweets = filteredTweets.length;
            const totalEngagement = filteredTweets.reduce((sum, tweet) => 
                sum + tweet.likes + tweet.retweets + tweet.replies, 0);
            const avgLikes = totalTweets > 0 ? Math.round(filteredTweets.reduce((sum, tweet) => 
                sum + tweet.likes, 0) / totalTweets) : 0;
            const uniqueUsers = new Set(filteredTweets.map(tweet => tweet.userId)).size;

            document.getElementById('totalTweets').textContent = totalTweets.toLocaleString();
            document.getElementById('totalEngagement').textContent = totalEngagement.toLocaleString();
            document.getElementById('avgLikes').textContent = avgLikes.toLocaleString();
            document.getElementById('uniqueUsers').textContent = uniqueUsers.toLocaleString();
        }

        // 渲染推文
        function renderTweets() {
            const container = document.getElementById('tweetsContainer');
            const start = (currentPage - 1) * tweetsPerPage;
            const end = start + tweetsPerPage;
            const pageTweets = filteredTweets.slice(start, end);

            if (pageTweets.length === 0) {
                container.innerHTML = '<div class="loading">没有找到匹配的推文</div>';
                return;
            }

            container.innerHTML = pageTweets.map((tweet, index) => {
                const globalIndex = start + index;
                const avatarChar = tweet.displayName.charAt(0).toUpperCase();
                const timeAgo = getTimeAgo(new Date(tweet.createdAt));
                
                return `
                    <div class="tweet" data-index="${globalIndex}">
                        <div class="tweet-header">
                            <div class="avatar">${avatarChar}</div>
                            <div class="user-info">
                                <div class="display-name">
                                    ${tweet.displayName}
                                    ${tweet.isVerified ? '<span class="verified">✓</span>' : ''}
                                </div>
                                <div class="username">@${tweet.username} · ${timeAgo}</div>
                            </div>
                        </div>
                        <div class="tweet-text">${tweet.text}</div>
                        <div class="tweet-stats">
                            <div class="stat">
                                <span>❤️</span>
                                <span>${tweet.likes.toLocaleString()}</span>
                            </div>
                            <div class="stat">
                                <span>🔁</span>
                                <span>${tweet.retweets.toLocaleString()}</span>
                            </div>
                            <div class="stat">
                                <span>💬</span>
                                <span>${tweet.replies.toLocaleString()}</span>
                            </div>
                            ${tweet.hasMedia ? '<div class="stat">📷 媒体</div>' : ''}
                        </div>
                        <div class="tweet-actions">
                            <button class="btn btn-primary" onclick="editTweet(${globalIndex})">AI改写</button>
                            <button class="btn btn-secondary" onclick="copyTweet(${globalIndex})">复制</button>
                        </div>
                    </div>
                `;
            }).join('');

            renderPagination();
        }

        // 计算时间差
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return `${seconds}秒前`;
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}分钟前`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}小时前`;
            const days = Math.floor(hours / 24);
            if (days < 30) return `${days}天前`;
            const months = Math.floor(days / 30);
            if (months < 12) return `${months}月前`;
            const years = Math.floor(months / 12);
            return `${years}年前`;
        }

        // 渲染分页
        function renderPagination() {
            const totalPages = Math.ceil(filteredTweets.length / tweetsPerPage);
            const pagination = document.getElementById('pagination');

            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let html = '';

            // 上一页按钮
            html += `<button class="page-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>上一页</button>`;

            // 页码按钮
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                html += `<button class="page-btn" onclick="goToPage(1)">1</button>`;
                if (startPage > 2) html += `<span>...</span>`;
            }

            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span>...</span>`;
                html += `<button class="page-btn" onclick="goToPage(${totalPages})">${totalPages}</button>`;
            }

            // 下一页按钮
            html += `<button class="page-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>下一页</button>`;

            pagination.innerHTML = html;
        }

        // 跳转到指定页
        function goToPage(page) {
            const totalPages = Math.ceil(filteredTweets.length / tweetsPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderTweets();
            window.scrollTo(0, 0);
        }

        // 搜索推文
        function searchTweets() {
            const query = document.getElementById('searchInput').value.toLowerCase();

            if (!query) {
                filteredTweets = [...allTweets];
            } else {
                filteredTweets = allTweets.filter(tweet => 
                    tweet.text.toLowerCase().includes(query) ||
                    tweet.username.toLowerCase().includes(query) ||
                    tweet.displayName.toLowerCase().includes(query)
                );
            }

            currentPage = 1;
            updateStats();
            renderTweets();
        }

        // 按互动筛选
        function filterByEngagement(level) {
            if (level === 'high') {
                filteredTweets = allTweets.filter(tweet => tweet.likes > 500);
            } else if (level === 'medium') {
                filteredTweets = allTweets.filter(tweet => tweet.likes >= 50 && tweet.likes <= 500);
            } else {
                filteredTweets = allTweets.filter(tweet => tweet.likes < 50);
            }

            currentPage = 1;
            updateStats();
            renderTweets();
        }

        // 筛选包含媒体的推文
        function filterByMedia() {
            filteredTweets = allTweets.filter(tweet => tweet.hasMedia);
            currentPage = 1;
            updateStats();
            renderTweets();
        }

        // 筛选认证用户
        function filterByVerified() {
            filteredTweets = allTweets.filter(tweet => tweet.isVerified);
            currentPage = 1;
            updateStats();
            renderTweets();
        }

        // 显示全部
        function showAll() {
            filteredTweets = [...allTweets];
            currentPage = 1;
            document.getElementById('searchInput').value = '';
            updateStats();
            renderTweets();
        }

        // 编辑推文
        function editTweet(index) {
            currentEditIndex = index;
            const tweet = filteredTweets[index];
            document.getElementById('originalText').textContent = tweet.text;
            document.getElementById('rewrittenText').value = tweet.rewrittenText || '';
            document.getElementById('editModal').style.display = 'flex';
        }

        // 设置语言
        function setLanguage(lang) {
            currentLanguage = lang;
            document.getElementById('langZh').classList.toggle('active', lang === 'zh');
            document.getElementById('langEn').classList.toggle('active', lang === 'en');
            
            if (lang === 'zh') {
                document.getElementById('rewriteTitle').textContent = 'AI改写建议：';
                document.getElementById('rewrittenText').placeholder = '点击下方按钮获取AI改写建议...';
            } else {
                document.getElementById('rewriteTitle').textContent = 'AI Rewrite Suggestion:';
                document.getElementById('rewrittenText').placeholder = 'Click the button below to get AI rewrite suggestions...';
            }
        }

        // AI改写功能
        async function aiRewrite() {
            const originalText = document.getElementById('originalText').textContent;
            const statusDiv = document.getElementById('aiStatus');
            const textarea = document.getElementById('rewrittenText');

            // 显示加载状态
            statusDiv.style.display = 'block';
            statusDiv.className = 'ai-status loading';
            statusDiv.textContent = currentLanguage === 'zh' ? '正在生成AI改写建议...' : 'Generating AI rewrite suggestions...';

            const systemRole = currentLanguage === 'zh' 
                ? `你是一位在Web3领域深耕5年的资深从业者，同时也是AI领域的专家。请用更加口语化、自然的方式改写推文，要求：
1. 保持原意的同时让内容更加生动有趣
2. 使用Web3社区常用的术语和表达方式
3. 适当添加emoji让推文更有活力
4. 确保内容听起来像是真人写的，而不是AI生成的
5. 保留重要的标签如#UnlockRitual和@ritualnet/@ritualfnd
6. 字数控制在280字符以内
7. 避免使用"让我们"、"大家"这种明显的号召性用语
8. 用更个人化的视角表达观点`
                : `You are a Web3 veteran with 5 years of experience and an AI expert. Please rewrite tweets in a more conversational and natural way:
1. Keep the original meaning while making it more engaging
2. Use common Web3 community terms and expressions
3. Add appropriate emojis to make tweets more lively
4. Ensure content sounds human-written, not AI-generated
5. Keep important hashtags like #UnlockRitual and mentions like @ritualnet/@ritualfnd
6. Keep within 280 characters
7. Avoid obvious call-to-action phrases like "let's" or "join us"
8. Express opinions from a more personal perspective`;

            const userPrompt = currentLanguage === 'zh' 
                ? `请改写以下推文，使其更加自然、口语化：\n\n${originalText}`
                : `Please rewrite the following tweet to make it more natural and conversational:\n\n${originalText}`;

            try {
                const response = await fetch(`${API_BASE_URL}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            { role: 'system', content: systemRole },
                            { role: 'user', content: userPrompt }
                        ],
                        temperature: 0.8,
                        max_tokens: 500
                    })
                });

                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }

                const data = await response.json();
                const rewrittenText = data.choices[0].message.content.trim();

                // 显示成功状态
                statusDiv.className = 'ai-status success';
                statusDiv.textContent = currentLanguage === 'zh' ? 'AI改写成功！' : 'AI rewrite successful!';
                textarea.value = rewrittenText;

                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);

            } catch (error) {
                console.error('AI改写错误:', error);
                statusDiv.className = 'ai-status error';
                statusDiv.textContent = currentLanguage === 'zh' 
                    ? `改写失败：${error.message}` 
                    : `Rewrite failed: ${error.message}`;
                
                // 提供备选方案
                const tweet = filteredTweets[currentEditIndex];
                const suggestions = currentLanguage === 'zh' ? [
                    `刚发现 @ritualnet 的去中心化AI方案，真的是太炸了！终于有项目在认真做链上AI了 🚀 #UnlockRitual`,
                    `${tweet.text} 🔥 WAGMI!`,
                    `必须要说，@ritualnet 这个项目是真的懂Web3+AI。不是那种蹭热度的，是真正在构建基础设施 💎 #UnlockRitual`,
                    `看了 @ritualnet 的技术文档，这才是DeFAI该有的样子啊！去中心化AI计算，链上推理，简直完美 ⚡ #UnlockRitual`
                ] : [
                    `Just discovered @ritualnet's decentralized AI solution - absolutely mind-blowing! Finally someone's doing onchain AI right 🚀 #UnlockRitual`,
                    `${tweet.text} 🔥 This is the way!`,
                    `Gotta say, @ritualnet really gets Web3+AI. Not just hype, they're building real infrastructure 💎 #UnlockRitual`,
                    `Checked @ritualnet's tech docs - THIS is what DeFAI should look like! Decentralized AI compute, onchain inference, chef's kiss ⚡ #UnlockRitual`
                ];
                
                const suggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
                textarea.value = suggestion;
            }
        }

        // 保存改写
        function saveRewrite() {
            const rewrittenText = document.getElementById('rewrittenText').value;
            if (rewrittenText && currentEditIndex >= 0) {
                filteredTweets[currentEditIndex].rewrittenText = rewrittenText;
                
                // 同步到原始数据
                const originalIndex = allTweets.findIndex(t => t.id === filteredTweets[currentEditIndex].id);
                if (originalIndex >= 0) {
                    allTweets[originalIndex].rewrittenText = rewrittenText;
                }
                
                alert(currentLanguage === 'zh' ? '改写已保存！' : 'Rewrite saved!');
                closeModal();
                renderTweets();
            }
        }

        // 复制改写文本
        function copyRewrite() {
            const textarea = document.getElementById('rewrittenText');
            textarea.select();
            document.execCommand('copy');
            
            const statusDiv = document.getElementById('aiStatus');
            statusDiv.style.display = 'block';
            statusDiv.className = 'ai-status success';
            statusDiv.textContent = currentLanguage === 'zh' ? '已复制到剪贴板！' : 'Copied to clipboard!';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 2000);
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditIndex = -1;
        }

        // 复制推文
        function copyTweet(index) {
            const tweet = filteredTweets[index];
            const textToCopy = tweet.rewrittenText || tweet.text;

            navigator.clipboard.writeText(textToCopy).then(() => {
                alert('推文已复制到剪贴板！');
            }).catch(err => {
                console.error('复制失败:', err);
                // 备用方案
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('推文已复制到剪贴板！');
            });
        }

        // 查看推文详情
        function viewTweet(index) {
            const tweet = filteredTweets[index];
            const url = `https://twitter.com/${tweet.username}/status/${tweet.id}`;
            window.open(url, '_blank');
        }

        // 导出数据
        function exportData() {
            const dataStr = JSON.stringify(filteredTweets, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

            const exportFileDefaultName = `ritual_tweets_export_${new Date().toISOString().slice(0, 10)}.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // 刷新数据
        function refreshData() {
            location.reload();
        }

        // 键盘快捷键
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // 搜索框回车事件
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchTweets();
            }
        });

        // 点击模态框外部关闭
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // 初始化应用
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>